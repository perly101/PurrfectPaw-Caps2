<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PurrfectPaw API Test</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      line-height: 1.6;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }
    .box {
      border: 1px solid #ddd;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    .success {
      background-color: #d4edda;
      border-color: #c3e6cb;
    }
    .error {
      background-color: #f8d7da;
      border-color: #f5c6cb;
    }
    .pending {
      background-color: #fff3cd;
      border-color: #ffeeba;
    }
    pre {
      background-color: #f8f9fa;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
    }
    button {
      background-color: #007bff;
      border: none;
      color: white;
      padding: 10px 15px;
      border-radius: 4px;
      cursor: pointer;
      margin-right: 10px;
      margin-bottom: 10px;
    }
    button:hover {
      background-color: #0069d9;
    }
    .btn-success {
      background-color: #28a745;
    }
    .btn-warning {
      background-color: #ffc107;
      color: #212529;
    }
    h2 {
      margin-top: 30px;
      border-bottom: 1px solid #eee;
      padding-bottom: 10px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #f2f2f2;
    }
    tr:nth-child(even) {
      background-color: #f9f9f9;
    }
  </style>
</head>
<body>
  <h1>PurrfectPaw API Test</h1>
  <p>This page helps test API connectivity for the PurrfectPaw application.</p>
  
  <div id="status" class="box pending">
    <h3>Status: Testing...</h3>
    <p>Checking API connection...</p>
  </div>
  
  <div>
    <button id="test-api" class="btn-primary">Test API Connection</button>
    <button id="reset" class="btn-warning">Reset</button>
    <button id="continue-app" class="btn-success">Continue to App (Bypass)</button>
  </div>
  
  <h2>Test Results</h2>
  <div id="results">
    <p>Click "Test API Connection" to start testing.</p>
  </div>
  
  <h2>API URLs Tested</h2>
  <table id="url-tests">
    <thead>
      <tr>
        <th>URL</th>
        <th>Status</th>
        <th>Time</th>
      </tr>
    </thead>
    <tbody>
      <!-- Results will appear here -->
    </tbody>
  </table>
  
  <h2>Troubleshooting</h2>
  <ul>
    <li>Make sure Laravel server is running with <code>php artisan serve --host=0.0.0.0 --port=8000</code></li>
    <li>Verify CORS is properly configured in your Laravel application</li>
    <li>Check that the health-check endpoint exists in your API routes</li>
    <li>For development, use the "Continue to App (Bypass)" button</li>
  </ul>

  <script>
    const statusBox = document.getElementById('status');
    const resultsDiv = document.getElementById('results');
    const urlTable = document.getElementById('url-tests').querySelector('tbody');
    
    // List of API URLs to test
    const apiUrls = [
      'http://localhost:8000/api/health-check',
      'http://127.0.0.1:8000/api/health-check',
      'http://192.168.1.10:8000/api/health-check',
      window.location.origin + '/api/health-check'
    ];
    
    // Test a specific API URL
    async function testApiUrl(url) {
      const startTime = Date.now();
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${url}</td>
        <td>Testing...</td>
        <td>-</td>
      `;
      urlTable.appendChild(row);
      
      try {
        const response = await fetch(url, {
          method: 'GET',
          headers: {
            'Accept': 'application/json'
          },
          signal: AbortSignal.timeout(5000)
        });
        
        const endTime = Date.now();
        const timeElapsed = endTime - startTime;
        
        if (response.ok) {
          const data = await response.json();
          row.cells[1].textContent = 'Success ✅';
          row.cells[2].textContent = `${timeElapsed}ms`;
          row.style.backgroundColor = '#d4edda';
          return { success: true, url, time: timeElapsed, data };
        } else {
          row.cells[1].textContent = `Failed (${response.status})`;
          row.cells[2].textContent = `${timeElapsed}ms`;
          row.style.backgroundColor = '#f8d7da';
          return { success: false, url, time: timeElapsed, status: response.status };
        }
      } catch (error) {
        const endTime = Date.now();
        const timeElapsed = endTime - startTime;
        
        row.cells[1].textContent = `Error: ${error.name}`;
        row.cells[2].textContent = `${timeElapsed}ms`;
        row.style.backgroundColor = '#f8d7da';
        return { success: false, url, time: timeElapsed, error: error.message };
      }
    }
    
    // Test all API URLs
    async function testAllApiUrls() {
      statusBox.className = 'box pending';
      statusBox.innerHTML = '<h3>Status: Testing...</h3><p>Checking API connections...</p>';
      
      urlTable.innerHTML = '';
      resultsDiv.innerHTML = '<p>Testing API endpoints...</p>';
      
      const results = [];
      
      for (const url of apiUrls) {
        const result = await testApiUrl(url);
        results.push(result);
        
        if (result.success) {
          // If we find a working URL, we can stop testing
          break;
        }
      }
      
      // Check if any API URL was successful
      const successfulResult = results.find(r => r.success);
      
      if (successfulResult) {
        statusBox.className = 'box success';
        statusBox.innerHTML = `
          <h3>Status: Connected ✅</h3>
          <p>Successfully connected to API at ${successfulResult.url}</p>
          <p>Response time: ${successfulResult.time}ms</p>
        `;
        
        resultsDiv.innerHTML = `
          <pre>${JSON.stringify(successfulResult.data, null, 2)}</pre>
        `;
      } else {
        statusBox.className = 'box error';
        statusBox.innerHTML = `
          <h3>Status: Failed ❌</h3>
          <p>Could not connect to any API endpoints.</p>
          <p>You may need to check that your Laravel server is running.</p>
        `;
        
        resultsDiv.innerHTML = `
          <p>All API connection attempts failed:</p>
          <pre>${JSON.stringify(results, null, 2)}</pre>
        `;
      }
    }
    
    // Event handlers
    document.getElementById('test-api').addEventListener('click', testAllApiUrls);
    
    document.getElementById('reset').addEventListener('click', () => {
      statusBox.className = 'box pending';
      statusBox.innerHTML = '<h3>Status: Ready</h3><p>Click "Test API Connection" to start testing.</p>';
      resultsDiv.innerHTML = '<p>Click "Test API Connection" to start testing.</p>';
      urlTable.innerHTML = '';
    });
    
    document.getElementById('continue-app').addEventListener('click', () => {
      window.location.href = '/?bypass=true';
    });
    
    // Initial test on page load
    window.addEventListener('load', testAllApiUrls);
  </script>
</body>
</html>